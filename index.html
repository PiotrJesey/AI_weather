<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Temperature Prediction System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: #4a5568;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .system-status {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #68d391;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #4a5568;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            font-size: 1.8rem;
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: #f8fafc;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        button:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.6s, height 0.6s;
            transform: translate(-50%, -50%);
        }

        button:active:before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #718096, #4a5568);
        }

        .btn-success {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }

        .btn-danger {
            background: linear-gradient(45deg, #f56565, #e53e3e);
        }

        .prediction-result {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .prediction-result::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .prediction-temp {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .prediction-detail {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .forecast-day {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .forecast-day:hover {
            transform: scale(1.05);
        }

        .forecast-date {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .forecast-temp {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .forecast-confidence {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .accuracy-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chart-container {
            height: 400px;
            margin: 20px 0;
            position: relative;
            background: white;
            border-radius: 15px;
            padding: 20px;
        }

        .data-table {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #f8fafc;
        }

        .accuracy-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .accuracy-good { background: #c6f6d5; color: #22543d; }
        .accuracy-fair { background: #fef5e7; color: #c05621; }
        .accuracy-poor { background: #fed7d7; color: #c53030; }
        .accuracy-pending { background: #e2e8f0; color: #4a5568; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.1rem;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .message-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .warning {
            background: #fef5e7;
            color: #c05621;
            border: 1px solid #f6ad55;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .forecast-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }

        .wide-card {
            grid-column: 1 / -1;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌡️ AI Temperature Prediction System</h1>
            <p class="subtitle">Advanced Machine Learning for Weather Forecasting</p>
            <div class="system-status">
                <div class="status-dot"></div>
                System Online - 400 Days of Training Data
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Add Temperature Data Card -->
            <div class="card">
                <h2><span class="card-icon">📊</span>Add Temperature Data</h2>
                <div class="form-group">
                    <label for="temperature">Temperature (°C)</label>
                    <input type="number" id="temperature" step="0.1" placeholder="25.5">
                </div>
                <div class="input-group">
                    <input type="number" id="humidity" step="0.1" placeholder="Humidity %" title="Humidity">
                    <input type="number" id="pressure" step="0.1" placeholder="Pressure hPa" title="Pressure">
                </div>
                <div class="input-group">
                    <input type="number" id="wind-speed" step="0.1" placeholder="Wind km/h" title="Wind Speed">
                    <input type="number" id="cloud-cover" step="0.1" placeholder="Cloud %" title="Cloud Cover">
                </div>
                <button onclick="addTemperatureData()">📈 Add Data Point</button>
                <button onclick="loadHistoricalData()" class="btn-secondary">🔄 Refresh Data</button>
            </div>

            <!-- Next Day Prediction Card -->
            <div class="card">
                <h2><span class="card-icon">🔮</span>Next Day Prediction</h2>
                <p style="color: #718096; margin-bottom: 20px;">AI-powered prediction for tomorrow's noon temperature</p>
                <button onclick="predictNextDay()" class="btn-success">🎯 Predict Tomorrow</button>
                <button onclick="retrainModel()" class="btn-secondary">🧠 Retrain Model</button>
                
                <div id="prediction-result" class="prediction-result">
                    <div class="prediction-temp" id="prediction-temp">--°C</div>
                    <div id="prediction-text">Tomorrow's Predicted Temperature</div>
                    <div class="prediction-details" id="prediction-details"></div>
                </div>
            </div>

            <!-- Multi-Day Forecast Card -->
            <div class="card">
                <h2><span class="card-icon">📅</span>7-Day Forecast</h2>
                <div class="form-group">
                    <label for="forecast-days">Forecast Days</label>
                    <select id="forecast-days">
                        <option value="3">3 Days</option>
                        <option value="7" selected>7 Days</option>
                        <option value="14">14 Days</option>
                    </select>
                </div>
                <button onclick="generateForecast()">📊 Generate Forecast</button>
                <div id="forecast-loading" class="loading" style="display: none;">Generating forecast...</div>
                <div id="forecast-container" class="forecast-container"></div>
            </div>

            <!-- Prediction Evaluation Card -->
            <div class="card">
                <h2><span class="card-icon">📈</span>Evaluate Accuracy</h2>
                <p style="color: #718096; margin-bottom: 20px;">Compare predictions with actual temperatures</p>
                <div class="input-group">
                    <input type="number" id="prediction-id" placeholder="Prediction ID">
                    <input type="number" id="actual-temp" step="0.1" placeholder="Actual Temp °C">
                </div>
                <button onclick="evaluatePrediction()">✅ Evaluate</button>
                <button onclick="loadAccuracyStats()" class="btn-secondary">📊 Load Stats</button>
            </div>
        </div>

        <!-- Model Performance Section -->
        <div class="card wide-card">
            <h2><span class="card-icon">🎯</span>Model Performance Dashboard</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="showTab('accuracy-tab')">Accuracy Stats</button>
                <button class="tab" onclick="showTab('predictions-tab')">Recent Predictions</button>
                <button class="tab" onclick="showTab('learning-tab')">Learning History</button>
                <button class="tab" onclick="showTab('analytics-tab')">Data Analytics</button>
            </div>

            <!-- Accuracy Stats Tab -->
            <div id="accuracy-tab" class="tab-content active">
                <div id="accuracy-loading" class="loading">Loading accuracy metrics...</div>
                <div id="accuracy-stats" class="accuracy-stats" style="display: none;"></div>
                
                <div class="chart-container">
                    <canvas id="accuracy-chart"></canvas>
                </div>
            </div>

            <!-- Recent Predictions Tab -->
            <div id="predictions-tab" class="tab-content">
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Prediction Date</th>
                                <th>Target Date</th>
                                <th>Predicted °C</th>
                                <th>Actual °C</th>
                                <th>Error</th>
                                <th>Accuracy</th>
                            </tr>
                        </thead>
                        <tbody id="predictions-table-body">
                            <tr><td colspan="7" class="loading">Loading predictions...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Learning History Tab -->
            <div id="learning-tab" class="tab-content">
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Adjustment Type</th>
                                <th>Error Before</th>
                                <th>Learning Rate</th>
                                <th>Changes</th>
                            </tr>
                        </thead>
                        <tbody id="learning-table-body">
                            <tr><td colspan="5" class="loading">Loading learning history...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content">
                <div class="analytics-grid">
                    <div class="chart-container">
                        <canvas id="seasonal-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="daily-pattern-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historical Data Visualization -->
        <div class="card wide-card">
            <h2><span class="card-icon">📈</span>Temperature Trends (Last 400 Days)</h2>
            <div class="chart-container">
                <canvas id="temperature-chart"></canvas>
            </div>
        </div>

        <!-- Recent Data Table -->
        <div class="card wide-card">
            <h2><span class="card-icon">📋</span>Recent Temperature Records</h2>
            <div class="data-table">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Temperature (°C)</th>
                            <th>Humidity (%)</th>
                            <th>Pressure (hPa)</th>
                            <th>Wind (km/h)</th>
                            <th>Clouds (%)</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <tr><td colspan="6" class="loading">Loading historical data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let temperatureChart, accuracyChart, seasonalChart, dailyChart;
        let currentPredictionId = null;

        // API base URL
        const API_BASE = 'http://localhost:3000/api';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadHistoricalData();
            loadAccuracyStats();
            loadRecentPredictions();
            checkSystemHealth();
        });

        // Show message functions
        function showMessage(message, type = 'success', icon = '✅') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<span class="message-icon">${icon}</span>${message}`;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => messageDiv.remove(), 300);
            }, 5000);
        }

        // Tab switching
        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');

            // Load data for specific tabs
            switch(tabId) {
                case 'predictions-tab':
                    loadRecentPredictions();
                    break;
                case 'learning-tab':
                    loadLearningHistory();
                    break;
                case 'analytics-tab':
                    loadAnalytics();
                    break;
            }
        }

        // System health check
        async function checkSystemHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const health = await response.json();
                
                if (health.status === 'healthy') {
                    const statusElement = document.querySelector('.system-status');
                    statusElement.innerHTML = `
                        <div class="status-dot"></div>
                        System Healthy - ${health.data_summary.total_records} Records, ${health.prediction_summary.predictions_today} Predictions Today
                    `;
                }
            } catch (error) {
                console.error('Health check failed:', error);
                const statusElement = document.querySelector('.system-status');
                statusElement.innerHTML = `
                    <div class="status-dot" style="background: #f56565;"></div>
                    System Issues Detected
                `;
                statusElement.style.background = 'linear-gradient(45deg, #f56565, #e53e3e)';
            }
        }

        // Add temperature data
        async function addTemperatureData() {
            const temperature = parseFloat(document.getElementById('temperature').value);
            const humidity = parseFloat(document.getElementById('humidity').value) || 60;
            const pressure = parseFloat(document.getElementById('pressure').value) || 1013;
            const wind_speed = parseFloat(document.getElementById('wind-speed').value) || 5;
            const cloud_cover = parseFloat(document.getElementById('cloud-cover').value) || 50;

            if (isNaN(temperature)) {
                showMessage('Please enter a valid temperature', 'error', '❌');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/temperature`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        temperature, 
                        humidity, 
                        pressure, 
                        wind_speed, 
                        cloud_cover,
                        date_time: new Date().toISOString()
                    }),
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('Temperature data added successfully! 📊');
                    // Clear form
                    document.getElementById('temperature').value = '';
                    document.getElementById('humidity').value = '';
                    document.getElementById('pressure').value = '';
                    document.getElementById('wind-speed').value = '';
                    document.getElementById('cloud-cover').value = '';
                    
                    loadHistoricalData();
                } else {
                    showMessage('Failed to add temperature data', 'error', '❌');
                }
            } catch (error) {
                showMessage('Error connecting to server', 'error', '❌');
                console.error('Error:', error);
            }
        }

        // Load historical temperature data
        async function loadHistoricalData() {
            try {
                const response = await fetch(`${API_BASE}/temperature/historical?days=30`);
                const data = await response.json();

                updateDataTable(data);
                updateTemperatureChart(data);
            } catch (error) {
                showMessage('Error loading historical data', 'error', '❌');
                console.error('Error:', error);
            }
        }

        // Predict next day temperature
        async function predictNextDay() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '🔄 Predicting...';

            try {
                const response = await fetch(`${API_BASE}/predict/next-day`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                const result = await response.json();

                if (result.success) {
                    currentPredictionId = result.prediction_id;
                    displayPrediction(result);
                    showMessage(`Tomorrow's temperature predicted: ${result.predicted_temperature}°C`, 'success', '🎯');
                } else {
                    showMessage('Prediction failed: ' + (result.error || 'Unknown error'), 'error', '❌');
                }
            } catch (error) {
                showMessage('Error making prediction', 'error', '❌');
                console.error('Error:', error);
            } finally {
                button.disabled = false;
                button.textContent = '🎯 Predict Tomorrow';
            }
        }

        // Display prediction result
        function displayPrediction(result) {
            const resultDiv = document.getElementById('prediction-result');
            const tempDiv = document.getElementById('prediction-temp');
            const textDiv = document.getElementById('prediction-text');
            const detailsDiv = document.getElementById('prediction-details');

            tempDiv.textContent = `${result.predicted_temperature}°C`;
            textDiv.textContent = 'Tomorrow\'s Predicted Temperature';
            
            const targetDate = new Date(result.target_date);
            const confidence = Math.round(result.confidence * 100);
            
            detailsDiv.innerHTML = `
                <div class="prediction-detail">
                    <strong>Date</strong><br>
                    ${targetDate.toLocaleDateString()}
                </div>
                <div class="prediction-detail">
                    <strong>Confidence</strong><br>
                    ${confidence}%
                </div>
                <div class="prediction-detail">
                    <strong>ID</strong><br>
                    #${result.prediction_id}
                </div>
                <div class="prediction-detail">
                    <strong>Model</strong><br>
                    Advanced AI
                </div>
            `;

            resultDiv.style.display = 'block';
            
            // Auto-fill prediction ID for evaluation
            document.getElementById('prediction-id').value = result.prediction_id;
        }

        // Generate multi-day forecast
        async function generateForecast() {
            const days = parseInt(document.getElementById('forecast-days').value);
            const loadingDiv = document.getElementById('forecast-loading');
            const containerDiv = document.getElementById('forecast-container');
            
            loadingDiv.style.display = 'block';
            containerDiv.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/forecast`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days })
                });

                const result = await response.json();

                if (result.success) {
                    displayForecast(result.forecasts);
                    showMessage(`${days}-day forecast generated successfully!`, 'success', '📅');
                } else {
                    showMessage('Forecast generation failed', 'error', '❌');
                }
            } catch (error) {
                showMessage('Error generating forecast', 'error', '❌');
                console.error('Error:', error);
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // Display forecast
        function displayForecast(forecasts) {
            const container = document.getElementById('forecast-container');
            
            container.innerHTML = forecasts.map(forecast => {
                if (forecast.error) {
                    return `
                        <div class="forecast-day" style="background: linear-gradient(45deg, #f56565, #e53e3e);">
                            <div class="forecast-date">Day ${forecast.day_offset}</div>
                            <div class="forecast-temp">Error</div>
                        </div>
                    `;
                }
                
                const date = new Date(forecast.date);
                const confidence = Math.round(forecast.confidence * 100);
                
                return `
                    <div class="forecast-day">
                        <div class="forecast-date">${date.toLocaleDateString()}</div>
                        <div class="forecast-temp">${forecast.predicted_temperature}°C</div>
                        <div class="forecast-confidence">${confidence}% confident</div>
                    </div>
                `;
            }).join('');
        }

        // Evaluate prediction
        async function evaluatePrediction() {
            const predictionId = parseInt(document.getElementById('prediction-id').value);
            const actualTemp = parseFloat(document.getElementById('actual-temp').value);

            if (isNaN(predictionId) || isNaN(actualTemp)) {
                showMessage('Please enter valid prediction ID and actual temperature', 'error', '❌');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/evaluate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        prediction_id: predictionId, 
                        actual_temperature: actualTemp 
                    })
                });

                const result = await response.json();

                if (result.success) {
                    const message = `Evaluation complete! Error: ${result.absolute_error}°C, Accuracy: ${result.accuracy_percentage}%`;
                    showMessage(message + (result.learning_triggered ? ' (Model retraining triggered)' : ''), 'success', '✅');
                    
                    // Clear form
                    document.getElementById('prediction-id').value = '';
                    document.getElementById('actual-temp').value = '';
                    
                    // Refresh stats
                    loadAccuracyStats();
                    loadRecentPredictions();
                } else {
                    showMessage('Evaluation failed: ' + result.error, 'error', '❌');
                }
            } catch (error) {
                showMessage('Error evaluating prediction', 'error', '❌');
                console.error('Error:', error);
            }
        }

        // Retrain model
        async function retrainModel() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '🔄 Retraining...';

            try {
                const response = await fetch(`${API_BASE}/retrain`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('Model retrained successfully! 🧠', 'success');
                } else {
                    showMessage('Retraining failed: ' + result.error, 'error', '❌');
                }
            } catch (error) {
                showMessage('Error retraining model', 'error', '❌');
                console.error('Error:', error);
            } finally {
                button.disabled = false;
                button.textContent = '🧠 Retrain Model';
            }
        }

        // Load accuracy statistics
        async function loadAccuracyStats() {
            try {
                const response = await fetch(`${API_BASE}/accuracy/detailed`);
                const data = await response.json();

                displayAccuracyStats(data.overall_stats);
                updateAccuracyChart(data.weekly_trend);
            } catch (error) {
                showMessage('Error loading accuracy stats', 'warning', '⚠️');
                console.error('Error:', error);
            }
        }

        // Display accuracy statistics
        function displayAccuracyStats(stats) {
            const loadingDiv = document.getElementById('accuracy-loading');
            const statsDiv = document.getElementById('accuracy-stats');
            
            if (!stats || stats.total_predictions === 0) {
                loadingDiv.textContent = 'No prediction data available yet';
                return;
            }

            loadingDiv.style.display = 'none';
            statsDiv.style.display = 'grid';

            statsDiv.innerHTML = `
                <div class="stat-item">
                    <span class="stat-value">${(stats.avg_absolute_error || 0).toFixed(2)}</span>
                    <span class="stat-label">Avg Error (°C)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${(stats.rmse || 0).toFixed(2)}</span>
                    <span class="stat-label">RMSE (°C)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${stats.total_predictions || 0}</span>
                    <span class="stat-label">Total Predictions</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${(stats.predictions_within_1_degree || 0).toFixed(0)}%</span>
                    <span class="stat-label">Within 1°C</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${(stats.predictions_within_2_degrees || 0).toFixed(0)}%</span>
                    <span class="stat-label">Within 2°C</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${(stats.min_error || 0).toFixed(2)} - ${(stats.max_error || 0).toFixed(2)}</span>
                    <span class="stat-label">Error Range</span>
                </div>
            `;
        }

        // Load recent predictions
        async function loadRecentPredictions() {
            try {
                const response = await fetch(`${API_BASE}/predictions/recent`);
                const data = await response.json();

                updatePredictionsTable(data);
            } catch (error) {
                console.error('Error loading recent predictions:', error);
            }
        }

        // Update predictions table
        function updatePredictionsTable(predictions) {
            const tbody = document.getElementById('predictions-table-body');
            
            if (predictions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading">No predictions available</td></tr>';
                return;
            }

            tbody.innerHTML = predictions.map(pred => {
                const predDate = new Date(pred.prediction_date).toLocaleDateString();
                const targetDate = new Date(pred.target_date).toLocaleDateString();
                const accuracy = pred.accuracy_rating;
                
                return `
                    <tr>
                        <td>${pred.id}</td>
                        <td>${predDate}</td>
                        <td>${targetDate}</td>
                        <td>${pred.predicted_temperature.toFixed(1)}°C</td>
                        <td>${pred.actual_temperature ? pred.actual_temperature.toFixed(1) + '°C' : '-'}</td>
                        <td>${pred.absolute_error ? pred.absolute_error.toFixed(2) + '°C' : '-'}</td>
                        <td><span class="accuracy-badge accuracy-${accuracy}">${accuracy.toUpperCase()}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Load learning history
        async function loadLearningHistory() {
            try {
                const response = await fetch(`${API_BASE}/model/learning-history`);
                const data = await response.json();

                updateLearningTable(data);
            } catch (error) {
                console.error('Error loading learning history:', error);
            }
        }

        // Update learning history table
        function updateLearningTable(history) {
            const tbody = document.getElementById('learning-table-body');
            
            if (history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="loading">No learning history available</td></tr>';
                return;
            }

            tbody.innerHTML = history.map(entry => {
                const date = new Date(entry.adjustment_date).toLocaleDateString();
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td>${entry.adjustment_type.replace('_', ' ')}</td>
                        <td>${entry.avg_error_before ? entry.avg_error_before.toFixed(2) + '°C' : '-'}</td>
                        <td>${entry.learning_rate ? entry.learning_rate.toFixed(4) : '-'}</td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${entry.parameters_changed || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Load analytics data
        async function loadAnalytics() {
            try {
                const response = await fetch(`${API_BASE}/analytics/temperature-patterns`);
                const data = await response.json();

                updateSeasonalChart(data.seasonal_patterns);
                updateDailyPatternChart(data.daily_patterns);
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Update data table
        function updateDataTable(data) {
            const tbody = document.getElementById('data-table-body');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">No data available</td></tr>';
                return;
            }

            tbody.innerHTML = data.slice(0, 20).map(record => {
                const date = new Date(record.date_time).toLocaleString();
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td>${record.temperature.toFixed(1)}°C</td>
                        <td>${(record.humidity || 0).toFixed(1)}%</td>
                        <td>${(record.pressure || 0).toFixed(1)} hPa</td>
                        <td>${(record.wind_speed || 0).toFixed(1)} km/h</td>
                        <td>${(record.cloud_cover || 0).toFixed(1)}%</td>
                    </tr>
                `;
            }).join('');
        }

        // Initialize charts
        function initializeCharts() {
            // Temperature trend chart
            const tempCtx = document.getElementById('temperature-chart').getContext('2d');
            temperatureChart = new Chart(tempCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Temperature History'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Temperature (°C)'
                            }
                        }
                    }
                }
            });

            // Accuracy trend chart
            const accCtx = document.getElementById('accuracy-chart').getContext('2d');
            accuracyChart = new Chart(accCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Prediction Accuracy Over Time'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Average Error (°C)'
                            }
                        }
                    }
                }
            });

            // Seasonal pattern chart
            const seasonalCtx = document.getElementById('seasonal-chart').getContext('2d');
            seasonalChart = new Chart(seasonalCtx, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Seasonal Temperature Patterns'
                        }
                    }
                }
            });

            // Daily pattern chart
            const dailyCtx = document.getElementById('daily-pattern-chart').getContext('2d');
            dailyChart = new Chart(dailyCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Daily Temperature Patterns'
                        }
                    }
                }
            });
        }

        // Update temperature chart
        function updateTemperatureChart(data) {
            const labels = data.map(d => new Date(d.date_time).toLocaleDateString()).slice(-50);
            const temperatures = data.map(d => d.temperature).slice(-50);
            const humidity = data.map(d => d.humidity || 0).slice(-50);

            temperatureChart.data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Temperature (°C)',
                        data: temperatures,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Humidity (%)',
                        data: humidity,
                        borderColor: 'rgb(118, 75, 162)',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            };

            temperatureChart.options.scales.y1 = {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'Humidity (%)'
                },
                grid: {
                    drawOnChartArea: false
                }
            };

            temperatureChart.update();
        }

        // Update accuracy chart
        function updateAccuracyChart(weeklyData) {
            if (!weeklyData || weeklyData.length === 0) return;

            const labels = weeklyData.map(w => `Week ${w.week_number}`);
            const errors = weeklyData.map(w => w.avg_error);

            accuracyChart.data = {
                labels: labels,
                datasets: [{
                    label: 'Average Error (°C)',
                    data: errors,
                    borderColor: 'rgb(72, 187, 120)',
                    backgroundColor: 'rgba(72, 187, 120, 0.1)',
                    tension: 0.4
                }]
            };

            accuracyChart.update();
        }

        // Update seasonal chart
        function updateSeasonalChart(seasonalData) {
            if (!seasonalData || seasonalData.length === 0) return;

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const labels = seasonal